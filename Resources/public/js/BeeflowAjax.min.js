var BeeflowAjax=BeeflowAjax||{},pingFunctions=[],BeeflowMessageComponent=BeeflowMessageComponent||{};BeeflowMessageComponent.success=function(e,a){alert(a+"\n\n"+e)},BeeflowMessageComponent.error=function(e,a){alert(a+"\n\n"+e)},BeeflowMessageComponent.warning=function(e,a){alert(a+"\n\n"+e)},BeeflowMessageComponent.info=function(e,a){alert(a+"\n\n"+e)},BeeflowAjax.send=function(e,a,n,i,t){$(n).addClass("disabled");var o=$(n).children()[0];if(void 0!==o){var s=$(o).attr("class");$(o).removeClass(s),$(o).addClass("fa fa-spin fa-spinner")}void 0===t&&(t="POST"),$.ajax({method:t,url:e,data:{data:a}}).done(function(e){if("string"==typeof e)var a=JSON.parse(e);else a=e;BeeflowAjax.ajaxResponseCommands(a),i&&"function"==typeof i&&i(a)}).fail(function(e){alert("Something is wrong :( Please contact with administrator."),console.log(e)}).always(function(){void 0!==o&&($(o).removeClass(),$(o).addClass(s)),$(n).removeClass("disabled")})},BeeflowAjax.pingRegister=function(e,a){pingFunctions[e]=a},BeeflowAjax.pingUnregister=function(e){delete pingFunctions[e]},BeeflowAjax.ping=function(){for(var e in pingFunctions)pingFunctions[e]()},BeeflowAjax.remove=function(e){$(e).remove()},BeeflowAjax.ajaxResponseCommands=function(e){for(index=0,len=e.length;index<len;++index){switch(e[index].cmd){case"alert":alert(e[index].data);break;case"alertSuccess":BeeflowMessageComponent.success("",e[index].data);break;case"alertError":BeeflowMessageComponent.error(e[index].data,"");break;case"alertWarning":BeeflowMessageComponent.warning("",e[index].data);break;case"alertInfo":BeeflowMessageComponent.info("",e[index].data);break;case"debug":console.log(e[index].data);break;case"remove":BeeflowAjax.remove(e[index].id);break;case"append":$(e[index].id).append(e[index].data);break;case"assign":$(e[index].id).html(e[index].data);break;case"addClass":$(e[index].id).addClass(e[index].data);break;case"removeClass":null==e[index].data?$(e[index].id).removeClass():$(e[index].id).removeClass(e[index].data);break;case"redirect":window.location.href=e[index].url;break;case"reloadLocation":window.location.reload();break;case"runScript":jQuery.globalEval(e[index].data);break;case"modal":$(e[index].id).modal(e[index].data);break;case"show":$(e[index].id).show();break;case"hide":$(e[index].id).hide();break;case"insertBefore":$(e[index].data).insertBefore(e[index].id)}}},BeeflowAjax.setFormFeedback=function(e,a){var n=$("#"+e).parents(".form-group"),i=n.find(".glyphicon");switch(a){case"error":n.addClass("has-error").removeClass("has-success").removeClass("has-warning"),i.addClass("glyphicon-remove").removeClass("glyphicon-ok").removeClass("glyphicon-warning-sign");break;case"warning":n.addClass("has-warning").removeClass("has-success").removeClass("has-error"),i.addClass("glyphicon-warning-sign").removeClass("glyphicon-ok").removeClass("glyphicon-remove");break;case"success":n.addClass("has-success").removeClass("has-warning").removeClass("has-error"),i.addClass("glyphicon-ok").removeClass("glyphicon-warning-sign").removeClass("glyphicon-remove");break;case"clear":n.removeClass("has-success").removeClass("has-warning").removeClass("has-error"),i.removeClass("glyphicon-ok").removeClass("glyphicon-warning-sign").removeClass("glyphicon-remove")}},BeeflowAjax.getFormValues=function(e){if("string"==typeof e)var a=$('form[name="'+e+'"]').serializeArray();else a=$(e).serializeArray();var n={};return jQuery.each(a,function(e,a){n=BeeflowAjax.prepareJson(n,a.name,a.value)}),JSON.stringify(n)},BeeflowAjax.prepareJson=function(e,a,n){if(null!=/\[(.*)\]/.exec(a)){var i=/(.*)\[/.exec(a)[1],t=/\[(.*)\]/.exec(a)[1];void 0===e[i]&&(e[i]={}),e[i]=BeeflowAjax.prepareJson(e[i],t,n)}else if(void 0!==e[a]&&"[object Array]"!==Object.prototype.toString.call(e[a])){var o=e[a];e[a]=[o,s(n)]}else void 0!==e[a]&&"[object Array]"===Object.prototype.toString.call(e[a])?e[a].push(s(n)):e[a]=s(n);function s(e){return $("<div/>").text(e).html()}return e},BeeflowAjax.initAjaxForms=function(){$(".ajax-form").each(function(){var e=this;$('button[type="submit"]').on("click",function(){$(e).data("button",this.name)}),$('input[type="submit"]').on("click",function(){$(e).data("input",this.name)});var n=$(e).data("callback"),i=$(e).attr("method");void 0===i&&(i="POST"),$(this).unbind("submit"),$(this).submit(function(e){var a=$(this).find('button[type="submit"]');0===a.length&&(a=$(this).find('input[type="submit"]')),BeeflowAjax.send($(this).attr("action"),BeeflowAjax.getFormValues(this),a,n,i),e.preventDefault()})})},BeeflowAjax.initAjaxLinks=function(){$(".ajax-link").each(function(){$(this).unbind("click"),$(this).click(function(e){if(void 0!==$(this).data("confirm")&&!confirm($(this).data("confirm")))return e.preventDefault(),!1;var a=$(this).attr("href");"#"!==a&&void 0!==a||(a=$(this).data("action"));var n=$(this).data("method");void 0===n&&(n="GET");var i=$(this).data("callback");BeeflowAjax.send(a,$(this).data(),this,i,n),e.preventDefault()})})};var AjaxSelect=[];function inArray(e,a){if("string"==typeof a&&(a=[a]),void 0===a)return!1;for(var n=a.length,i=0;i<n;i++)if("object"==typeof a[i]){if(arrayCompare(a[i],e))return!0}else if(a[i]==e)return!0;return!1}function removeFromAjaxSelect(e){for(var a in AjaxSelect)"bar"==AjaxSelect[a]&&AjaxSelect.splice(a,1)}BeeflowAjax.initAjaxSelect=function(t){$("select").each(function(){if(void 0!==$(this).data("ajax-datasource")&&(!inArray($(this).attr("id"),AjaxSelect)||t==$(this).attr("id"))){$(this).unbind("change"),$(this).find("option").remove(),AjaxSelect.push($(this).attr("id"));var o=$(this),e=$.ajax({url:$(this).data("ajax-datasource")}),a=url("?"+$(this).data("url-value"),decodeURIComponent(url())),n="undefined"===$(this).data("default-value")?null:$(this).data("default-value"),s=null==a?n:a;if(void 0===$(this).attr("multiple")){var i=new Option("--",0,null==s,null==s);o.append(i)}e.then(function(e){if("string"==typeof e)e=JSON.parse(e);for(var a=0;a<e.length;a++){var n=e[a];if("object"!=typeof s)var i=s==n.id;else i=inArray(n.id,s);var t=new Option(n.text,n.id,i,i);o.append(t)}})}})},$(document).ready(function(){BeeflowAjax.initAjaxForms(),BeeflowAjax.initAjaxLinks(),BeeflowAjax.initAjaxSelect(),setInterval(BeeflowAjax.ping,6e4)});