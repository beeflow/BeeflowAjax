var BeeflowAjax=BeeflowAjax||{},pingFunctions=[],BeeflowMessageComponent=BeeflowMessageComponent||{};BeeflowMessages={"Internal Server Error":"Internal Server Error","The server encountered something unexpected that didn't allow it to complete the request. We apologize.":"The server encountered something unexpected that didn't allow it to complete the request. We apologize.","This file is too large":"This file is too large!"},BeeflowMessageComponent.success=function(e,a){alert(a+"\n\n"+e)},BeeflowMessageComponent.error=function(e,a){alert(a+"\n\n"+e)},BeeflowMessageComponent.internalServerError=function(){var e=[BeeflowMessages["Internal Server Error"],BeeflowMessages["The server encountered something unexpected that didn't allow it to complete the request. We apologize."]];alert(e.join("\n\n"))},BeeflowMessageComponent.warning=function(e,a){alert(a+"\n\n"+e)},BeeflowMessageComponent.info=function(e,a){alert(a+"\n\n"+e)},BeeflowMessageComponent.confirm=function(e,a){return confirm($(e).data("confirm"))},BeeflowAjax.send=function(e,a,n,i,t){$(n).addClass("disabled");var o=$(n).children()[0];if(void 0!==o){var r=$(o).attr("class");$(o).removeClass(r),$(o).addClass("fa fa-spin fa-spinner")}void 0===t&&(t="POST"),$.ajax({method:t,url:e,data:{data:a}}).done(function(e){if("string"==typeof e)var a=JSON.parse(e);else a=e;BeeflowAjax.ajaxResponseCommands(a),i&&"function"==typeof i&&i(a)}).fail(function(e){"Unauthorized"!==code?(BeeflowMessageComponent.internalServerError(),console.log(e)):window.location.href="/"}).always(function(){void 0!==o&&($(o).removeClass(),$(o).addClass(r)),$(n).removeClass("disabled")})},BeeflowAjax.pingRegister=function(e,a){pingFunctions[e]=a},BeeflowAjax.pingUnregister=function(e){delete pingFunctions[e]},BeeflowAjax.ping=function(){for(var e in pingFunctions)pingFunctions[e]()},BeeflowAjax.remove=function(e){$(e).remove()},BeeflowAjax.loadScript=function($scriptName,$callback){$.ajax({url:$scriptName,dataType:"script",async:!0}).done(function(){eval($callback)()})},BeeflowAjax.ajaxResponseCommands=function(e){for(index=0,len=e.length;index<len;++index){switch(e[index].cmd){case"alert":alert(e[index].data);break;case"alertSuccess":BeeflowMessageComponent.success(e[index].data,e[index].title);break;case"alertError":BeeflowMessageComponent.error(e[index].data,e[index].title);break;case"alertWarning":BeeflowMessageComponent.warning(e[index].data,e[index].title);break;case"alertInfo":BeeflowMessageComponent.info(e[index].data,e[index].title);break;case"debug":console.log(e[index].data);break;case"remove":BeeflowAjax.remove(e[index].id);break;case"append":$(e[index].id).append(e[index].data);break;case"assign":$(e[index].id).html(e[index].data);break;case"addClass":$(e[index].id).addClass(e[index].data);break;case"removeClass":null==e[index].data?$(e[index].id).removeClass():$(e[index].id).removeClass(e[index].data);break;case"redirect":window.location.href=e[index].url;break;case"reloadLocation":window.location.reload();break;case"runScript":jQuery.globalEval(e[index].data);break;case"modal":$(e[index].id).modal(e[index].data);break;case"show":$(e[index].id).show();break;case"hide":$(e[index].id).hide();break;case"insertBefore":$(e[index].data).insertBefore(e[index].id);break;case"initAjaxLinks":BeeflowAjax.initAjaxLinks();break;case"initAjaxForms":BeeflowAjax.initAjaxForms();break;case"initAjaxSelect":BeeflowAjax.initAjaxSelect();break;case"loadScript":BeeflowAjax.loadScript(e[index].script,e[index].callback)}}},BeeflowAjax.setFormFeedback=function(e,a){var n=$("#"+e).parents(".form-group"),i=n.find(".glyphicon");switch(a){case"error":n.addClass("has-error").removeClass("has-success").removeClass("has-warning"),i.addClass("glyphicon-remove").removeClass("glyphicon-ok").removeClass("glyphicon-warning-sign");break;case"warning":n.addClass("has-warning").removeClass("has-success").removeClass("has-error"),i.addClass("glyphicon-warning-sign").removeClass("glyphicon-ok").removeClass("glyphicon-remove");break;case"success":n.addClass("has-success").removeClass("has-warning").removeClass("has-error"),i.addClass("glyphicon-ok").removeClass("glyphicon-warning-sign").removeClass("glyphicon-remove");break;case"clear":n.removeClass("has-success").removeClass("has-warning").removeClass("has-error"),i.removeClass("glyphicon-ok").removeClass("glyphicon-warning-sign").removeClass("glyphicon-remove")}},BeeflowAjax.getFormValues=function(e){if("string"==typeof e)var a=$('form[name="'+e+'"]').serializeArray();else a=$(e).serializeArray();var n={};return jQuery.each(a,function(e,a){n[a.name]=a.value}),JSON.stringify(BeeflowAjax.prepareJson(n))},BeeflowAjax.prepareJson=function(e){var a,n={};e:for(var i in e){var t=e[i],o=i.split("["),r=n;for(var s in o){var l=o[s];if("]"==l.substr(-1)&&(l=l.substr(0,l.length-1)),s==o.length-1){r[l]=(a=t,$("<div/>").text(a).html());continue e}r.hasOwnProperty(l)||(r[l]={}),r=r[l]}}return n},BeeflowAjax.initAjaxForms=function(){$(".ajax-form").each(function(){var e=this;$('button[type="submit"]').on("click",function(){$(e).data("button",this.name)}),$('input[type="submit"]').on("click",function(){$(e).data("input",this.name)});var n=$(e).data("callback"),i=$(e).attr("method");void 0===i&&(i="POST"),$(this).unbind("submit"),$(this).submit(function(e){var a=$(this).find('button[type="submit"]');0===a.length&&(a=$(this).find('input[type="submit"]')),BeeflowAjax.send($(this).attr("action"),BeeflowAjax.getFormValues(this),a,n,i),e.preventDefault()})})},BeeflowAjax.linkClickedAction=function(e,a){var n=$(e).attr("href");"#"!==n&&void 0!==n||(n=$(e).data("action"));var i=$(e).data("method");void 0===i&&(i="GET");var t=$(e).data("callback");BeeflowAjax.send(n,$(e).data(),e,t,i),a.preventDefault()},BeeflowAjax.initAjaxLinks=function(){$(".ajax-link").each(function(){$(this).unbind("click"),$(this).click(function(e){if(void 0!==$(this).data("confirm")&&!BeeflowMessageComponent.confirm($(this),e))return e.preventDefault(),!1;BeeflowAjax.linkClickedAction($(this),e)})})};var AjaxSelect=[];function inArray(e,a){if("string"==typeof a&&(a=[a]),void 0===a)return!1;for(var n=a.length,i=0;i<n;i++)if("object"==typeof a[i]){if(arrayCompare(a[i],e))return!0}else if(a[i]==e)return!0;return!1}function removeFromAjaxSelect(e){for(var a in AjaxSelect)"bar"==AjaxSelect[a]&&AjaxSelect.splice(a,1)}BeeflowAjax.initAjaxSelect=function(t){$("select").each(function(){if(void 0!==$(this).data("ajax-datasource")&&(!inArray($(this).attr("id"),AjaxSelect)||t==$(this).attr("id"))){$(this).unbind("change"),$(this).find("option").remove(),AjaxSelect.push($(this).attr("id"));var o=$(this),e=$.ajax({url:$(this).data("ajax-datasource")}),a=url("?"+$(this).data("url-value"),decodeURIComponent(url())),n="undefined"===$(this).data("default-value")?null:$(this).data("default-value"),r=null==a?n:a;if(void 0===$(this).attr("multiple")){var i=new Option("--",0,null==r,null==r);o.append(i)}e.then(function(e){if("string"==typeof e)e=JSON.parse(e);for(var a=0;a<e.length;a++){var n=e[a];if("object"!=typeof r)var i=r==n.id;else i=inArray(n.id,r);var t=new Option(n.text,n.id,i,i);o.append(t)}})}})},$(document).ready(function(){BeeflowAjax.initAjaxForms(),BeeflowAjax.initAjaxLinks(),BeeflowAjax.initAjaxSelect(),setInterval(BeeflowAjax.ping,6e4)});